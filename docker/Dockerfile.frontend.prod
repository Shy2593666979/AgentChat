# ğŸ¨ å‰ç«¯ç”Ÿäº§ç¯å¢ƒå¤šé˜¶æ®µæ„å»º

# ğŸ—ï¸ æ„å»ºé˜¶æ®µ
FROM node:18-alpine as build-stage

# ğŸ”§ è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ğŸ“¦ è®¾ç½®npmé•œåƒæºï¼ˆåŠ é€Ÿä¸‹è½½ï¼‰
RUN npm config set registry https://registry.npmmirror.com

# ğŸ“‹ å¤åˆ¶packageæ–‡ä»¶
COPY src/frontend/package*.json ./

# ğŸš€ å®‰è£…ä¾èµ–
RUN npm ci --only=production --silent && npm cache clean --force

# ğŸ“ å¤åˆ¶æºä»£ç 
COPY src/frontend/ .

# ğŸŒ è®¾ç½®æ„å»ºç¯å¢ƒå˜é‡
ENV NODE_ENV=production
ENV VITE_API_BASE_URL=/api

# ğŸ—ï¸ æ„å»ºç”Ÿäº§ç‰ˆæœ¬
RUN npm run build

# ğŸš€ ç”Ÿäº§è¿è¡Œé˜¶æ®µ
FROM nginx:alpine as production-stage

# ğŸ“‹ å¤åˆ¶nginxé…ç½®
COPY docker/nginx.conf /etc/nginx/nginx.conf

# ğŸ“ å¤åˆ¶æ„å»ºç»“æœ
COPY --from=build-stage /app/dist /usr/share/nginx/html

# ğŸš€ æš´éœ²ç«¯å£
EXPOSE 8090

# ğŸƒâ€â™‚ï¸ å¯åŠ¨nginx
CMD ["nginx", "-g", "daemon off;"]
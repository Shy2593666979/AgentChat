# ğŸ Python 3.12+ åŸºç¡€é•œåƒ
FROM python:3.12-slim as backend-base

# ğŸ“¦ å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    curl \
    git \
    && rm -rf /var/lib/apt/lists/*

# ğŸ”§ è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ğŸ“‹ å¤åˆ¶Pythonä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# ğŸš€ å®‰è£…Pythonä¾èµ–ï¼ˆä½¿ç”¨pipé•œåƒæºåŠ é€Ÿï¼‰
RUN pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/

# ğŸ“ å¤åˆ¶åç«¯ä»£ç 
COPY src/backend/ .

# ğŸŒ è®¾ç½®ç¯å¢ƒå˜é‡
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1

# ğŸš€ æš´éœ²ç«¯å£
EXPOSE 7860

# ğŸƒâ€â™‚ï¸ å¯åŠ¨åç«¯æœåŠ¡
CMD ["uvicorn", "agentchat.main:app", "--host", "0.0.0.0", "--port", "7860", "--reload"]
